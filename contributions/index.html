<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>GitHub 3D Contributions Calendar (Mock)</title>
  <meta name="description" content="GitHub-style isometric 3D contributions calendar + 2D heatmap mock. Token-ready for GitHub GraphQL." />
  <style>
    :root{
      --bg-color:#ffffff;
      --text-primary:#24292f;
      --text-secondary:#586069;
      --green-0:#EBEDF0;
      --green-1:#9BE9A8;
      --green-2:#40C463;
      --green-3:#30A14E;
      --green-4:#216E39;
      --border:#D0D7DE;
      --link:#0969da;
      --shadow:rgba(27,31,36,.12);
      --mono: ui-monospace, SFMono-Regular, SF Mono, Menlo, Consolas, Liberation Mono, monospace;
      --sans: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
    }

    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:var(--sans);
      background:var(--bg-color);
      color:var(--text-primary);
    }

    .wrap{max-width:1100px;margin:32px auto;padding:0 16px}

    .card{
      border:1px solid var(--border);
      border-radius:12px;
      background:#fff;
      box-shadow:0 8px 30px rgba(27,31,36,.06);
      overflow:hidden;
    }

    .header{
      display:flex;
      align-items:center;
      justify-content:space-between;
      padding:16px 16px;
      border-bottom:1px solid var(--border);
      gap:12px;
      flex-wrap:wrap;
    }

    .header h2{
      margin:0;
      font-size:16px;
      font-weight:600;
      letter-spacing:-.01em;
    }

    .controls{display:flex;gap:8px;align-items:center}

    .segmented{
      display:inline-flex;
      border:1px solid var(--border);
      border-radius:8px;
      overflow:hidden;
      background:#f6f8fa;
    }
    .segmented button{
      appearance:none;
      border:0;
      background:transparent;
      padding:8px 10px;
      font-size:12px;
      color:var(--text-primary);
      cursor:pointer;
      font-weight:600;
    }
    .segmented button[aria-pressed="true"]{
      background:#fff;
      box-shadow:0 1px 0 rgba(27,31,36,.04);
    }

    .btn{
      border:1px solid var(--border);
      background:#f6f8fa;
      color:var(--text-primary);
      border-radius:8px;
      padding:8px 10px;
      font-size:12px;
      font-weight:600;
      cursor:pointer;
    }
    .btn:active{transform:translateY(1px)}

    .chart-container{
      display:grid;
      grid-template-columns: 1fr 280px;
      gap:16px;
      padding:16px;
      align-items:start;
    }

    /* ===== Isometric 3D chart ===== */
    .iso-shell{
      position:relative;
      border:1px solid var(--border);
      border-radius:12px;
      background:linear-gradient(#ffffff, #fbfbfc);
      padding:14px;
      overflow:hidden;
    }

    .iso-stage{
      position:relative;
      height:290px;
      border-radius:10px;
      background:radial-gradient(1200px 400px at 20% 0%, rgba(64,196,99,.10), transparent 55%),
                 radial-gradient(900px 320px at 80% 100%, rgba(33,110,57,.08), transparent 60%);
      border:1px dashed rgba(208,215,222,.7);
      overflow:hidden;
    }

    /* Obelisk canvas (jasonlong/isometric-contributions style) */
    #iso-canvas{
      background: transparent;
    }

    /* Tooltip */
    .tooltip{
      position:absolute;
      pointer-events:none;
      padding:8px 10px;
      border-radius:10px;
      border:1px solid rgba(208,215,222,.9);
      background:#ffffff;
      box-shadow:0 12px 40px rgba(27,31,36,.18);
      font-size:12px;
      color:var(--text-primary);
      transform:translate(-50%, calc(-100% - 12px));
      white-space:nowrap;
      opacity:0;
      transition:opacity .12s ease;
    }
    .tooltip .k{color:var(--text-secondary);font-family:var(--mono);font-size:11px}

    /* ===== Stats panel ===== */
    .stats{
      border:1px solid var(--border);
      border-radius:12px;
      padding:14px;
      background:#fff;
      position:sticky;
      top:16px;
    }
    .stats .block{padding:10px 0;border-bottom:1px solid #f0f2f4}
    .stats .block:last-child{border-bottom:0}
    .stats .label{font-size:12px;color:var(--text-secondary);margin-bottom:6px}
    .stats .big{font-size:32px;font-weight:800;color:var(--green-4);line-height:1.05;letter-spacing:-.02em}
    .stats .small{font-size:12px;color:var(--text-secondary)}

    /* ===== 2D heatmap ===== */
    .heatmap-wrap{padding:0 16px 16px}
    .heatmap{
      border-top:1px solid var(--border);
      padding-top:16px;
    }
    .heat-head{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:12px;
      flex-wrap:wrap;
      margin-bottom:8px;
    }

    .heat-grid{
      display:grid;
      grid-template-columns: 28px 1fr;
      gap:10px;
      align-items:start;
    }

    .dow{
      display:grid;
      grid-template-rows: repeat(7, 12px);
      gap:4px;
      font-size:11px;
      color:var(--text-secondary);
      padding-top:18px;
    }
    .dow span{line-height:12px}

    .grid-area{position:relative; overflow:auto; padding-bottom:6px}
    .months{
      display:grid;
      grid-template-columns: repeat(53, 12px);
      gap:4px;
      font-size:11px;
      color:var(--text-secondary);
      margin-bottom:6px;
      padding-left:0;
    }
    .months span{
      grid-row:1;
      justify-self:start;
      transform:translateX(-2px);
    }

    .cells{
      display:grid;
      grid-auto-flow:column;
      grid-template-rows: repeat(7, 12px);
      grid-auto-columns: 12px;
      gap:4px;
      align-items:center;
    }

    .cell{
      width:12px;height:12px;
      border-radius:3px;
      background:var(--green-0);
      box-shadow: inset 0 0 0 1px rgba(27,31,36,.04);
    }

    .legend{
      display:flex;
      align-items:center;
      justify-content:flex-end;
      gap:8px;
      margin-top:10px;
      font-size:12px;
      color:var(--text-secondary);
    }
    .legend .sw{display:flex; gap:4px; align-items:center}
    .legend i{display:inline-block;width:12px;height:12px;border-radius:3px}

    .footer{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:12px;
      flex-wrap:wrap;
      padding:12px 16px 16px;
      color:var(--text-secondary);
      font-size:12px;
    }
    .footer a{color:var(--link);text-decoration:none}
    .footer a:hover{text-decoration:underline}

    .toggle{
      display:inline-flex;
      align-items:center;
      gap:8px;
    }
    .toggle input{transform:translateY(1px)}

    /* responsive */
    @media (max-width: 900px){
      .chart-container{grid-template-columns:1fr}
      .stats{position:relative; top:auto}
      .iso-world{width:520px}
    }
    @media (max-width: 768px){
      .iso-shell{display:none}
    }

    /* reduce motion */
    @media (prefers-reduced-motion: reduce){
      .bar{animation:none;opacity:1;transform: translate3d(var(--x), var(--y), 0) translateZ(var(--h))}
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card contribution-calendar" id="cc">
      <div class="header">
        <h2 id="header-title">1,516 contributions in the last year</h2>
        <div class="controls">
          <div class="segmented" role="group" aria-label="View mode">
            <button id="btn-3d" aria-pressed="true" title="3D">3D</button>
            <button id="btn-2d" aria-pressed="false" title="Grid">Grid</button>
          </div>
          <button class="btn" id="btn-settings" type="button" aria-haspopup="menu" aria-expanded="false">Contribution settings ▾</button>
        </div>
      </div>

      <div class="chart-container" id="main-area">
        <div class="iso-shell" id="iso-shell" aria-label="Isometric contribution chart">
          <div class="iso-stage" id="iso-stage">
            <!-- Replaced: original CSS-isometric DOM bars -> obelisk.js canvas (as jasonlong/isometric-contributions) -->
            <canvas id="iso-canvas" width="1000" height="600" style="width:100%;height:100%;display:block"></canvas>
            <div class="tooltip" id="tooltip" role="status" aria-live="polite"></div>
          </div>
        </div>

        <aside class="stats" aria-label="Contribution statistics">
          <div class="block">
            <div class="label">1 year total</div>
            <div class="big" id="stat-total">1,516</div>
            <div class="small" id="stat-range">Nov 6, 2025 — Jan 17, 2026</div>
          </div>
          <div class="block">
            <div class="label">Busiest day</div>
            <div class="big" id="stat-busy">53</div>
            <div class="small" id="stat-busy-date">Mar 27</div>
          </div>
          <div class="block">
            <div class="label">Longest streak</div>
            <div class="big" id="stat-long">16</div>
            <div class="small" id="stat-long-range">Feb 1 — Feb 16</div>
          </div>
          <div class="block">
            <div class="label">Current streak</div>
            <div class="big" id="stat-cur">1</div>
            <div class="small" id="stat-cur-range">Nov 8 — Nov 8</div>
          </div>
        </aside>
      </div>

      <div class="heatmap-wrap" id="heatmap-wrap">
        <div class="heatmap" aria-label="Contribution heatmap">
          <div class="heat-head">
            <div style="font-size:12px;color:var(--text-secondary)">
              Traditional contributions grid (GitHub-style)
            </div>
          </div>

          <div class="heat-grid">
            <div class="dow" aria-hidden="true">
              <span></span>
              <span>Mon</span>
              <span></span>
              <span>Wed</span>
              <span></span>
              <span>Fri</span>
              <span></span>
            </div>

            <div class="grid-area">
              <div class="months" id="months" aria-hidden="true"></div>
              <div class="cells" id="cells"></div>

              <div class="legend" aria-label="Legend">
                <span>Less</span>
                <span class="sw" aria-hidden="true">
                  <i style="background:var(--green-0)"></i>
                  <i style="background:var(--green-1)"></i>
                  <i style="background:var(--green-2)"></i>
                  <i style="background:var(--green-3)"></i>
                  <i style="background:var(--green-4)"></i>
                </span>
                <span>More</span>
              </div>
            </div>
          </div>

          <div class="footer">
            <a href="https://docs.github.com/en/account-and-profile/setting-up-and-managing-your-github-profile/managing-contribution-settings-on-your-profile" target="_blank" rel="noreferrer">Learn how we count contributions.</a>
            <label class="toggle" for="hide-normal">
              <input id="hide-normal" type="checkbox" />
              Hide normal chart
            </label>
          </div>
        </div>
      </div>

    </div>
  </div>

  <script src="vendor/isometric-contributions/src/obelisk.min.js"></script>
  <script>
    // ========= isometric-contributions (jasonlong) integration (source reuse) =========
    // Repo: https://github.com/jasonlong/isometric-contributions
    // License: MIT https://github.com/jasonlong/isometric-contributions/blob/master/LICENSE

    const fmt = new Intl.NumberFormat('en-US');
    const MONTHS = ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];

    function formatDateHuman(iso){
      const d = new Date(iso + 'T00:00:00');
      return `${MONTHS[d.getMonth()]} ${d.getDate()}, ${d.getFullYear()}`;
    }

    function getCss(varName){
      return getComputedStyle(document.documentElement).getPropertyValue(varName).trim();
    }

    function colorForCount(count){
      if(count<=0) return getCss('--green-0');
      if(count<=3) return getCss('--green-1');
      if(count<=6) return getCss('--green-2');
      if(count<=9) return getCss('--green-3');
      return getCss('--green-4');
    }

    function precisionRound(number, precision){
      const factor = 10 ** precision;
      return Math.round(number * factor) / factor;
    }

    function datesDayDifference(date1, date2){
      if(!date1 || !date2) return null;
      const timeDiff = Math.abs(date2.getTime() - date1.getTime());
      return Math.ceil(timeDiff / (1000 * 3600 * 24));
    }

    // Placeholder generator: returns 365 days ending today (local) with random counts.
    function generateContributionData(){
      const data = [];
      const end = new Date();
      end.setHours(0,0,0,0);
      const start = new Date(end);
      start.setDate(start.getDate() - 364);

      for(let i=0;i<365;i++){
        const d = new Date(start);
        d.setDate(start.getDate()+i);
        const iso = d.toISOString().slice(0,10);
        const r = Math.random();
        let count = 0;
        if(r>0.35 && r<=0.75) count = 1 + Math.floor(Math.random()*3);
        else if(r>0.75 && r<=0.92) count = 4 + Math.floor(Math.random()*3);
        else if(r>0.92 && r<=0.98) count = 7 + Math.floor(Math.random()*3);
        else if(r>0.98) count = 10 + Math.floor(Math.random()*8);
        data.push({date:iso, count});
      }
      return data;
    }

    // ===== Stats (compatible with GitHub-like streak logic) =====
    function calcStats(days){
      const total = days.reduce((s,d)=>s+d.count,0);
      let busiest = days[0];
      for(const d of days){ if(d.count > busiest.count) busiest = d; }

      // Longest streak (count>0)
      let bestLen=0,bestStart=null,bestEnd=null;
      let curLen=0,curStart=null;
      for(let i=0;i<days.length;i++){
        if(days[i].count>0){
          if(curLen===0) curStart = days[i].date;
          curLen++;
          if(curLen>=bestLen){
            bestLen=curLen;
            bestStart=curStart;
            bestEnd=days[i].date;
          }
        } else {
          curLen=0;
          curStart=null;
        }
      }

      // Current streak: from end backwards (if today 0, allow yesterday)
      let currentLen=0;
      let curEnd = days[days.length-1].date;
      let curStreakStart = curEnd;
      for(let i=days.length-1;i>=0;i--){
        if(i===days.length-1 && days[i].count===0){
          // today 0 → start from yesterday
          curEnd = days[Math.max(0, i-1)].date;
          continue;
        }
        if(days[i].count>0){
          currentLen++;
          curStreakStart = days[i].date;
        } else break;
      }

      return {
        total,
        rangeStart: days[0].date,
        rangeEnd: days[days.length-1].date,
        busiest,
        longest:{len:bestLen, start:bestStart, end:bestEnd},
        current:{len:currentLen, start:curStreakStart, end:curEnd}
      };
    }

    function applyStats(stats){
      document.getElementById('header-title').textContent = `${fmt.format(stats.total)} contributions in the last year`;
      document.getElementById('stat-total').textContent = fmt.format(stats.total);

      const rs = new Date(stats.rangeStart+'T00:00:00');
      const re = new Date(stats.rangeEnd+'T00:00:00');
      document.getElementById('stat-range').textContent = `${MONTHS[rs.getMonth()]} ${rs.getDate()}, ${rs.getFullYear()} — ${MONTHS[re.getMonth()]} ${re.getDate()}, ${re.getFullYear()}`;

      document.getElementById('stat-busy').textContent = String(stats.busiest.count);
      const bd = new Date(stats.busiest.date+'T00:00:00');
      document.getElementById('stat-busy-date').textContent = `${MONTHS[bd.getMonth()]} ${bd.getDate()}`;

      document.getElementById('stat-long').textContent = String(stats.longest.len);
      if(stats.longest.start && stats.longest.end){
        const ls = new Date(stats.longest.start+'T00:00:00');
        const le = new Date(stats.longest.end+'T00:00:00');
        document.getElementById('stat-long-range').textContent = `${MONTHS[ls.getMonth()]} ${ls.getDate()} — ${MONTHS[le.getMonth()]} ${le.getDate()}`;
      }

      document.getElementById('stat-cur').textContent = String(stats.current.len);
      const cs = new Date(stats.current.start+'T00:00:00');
      const ce = new Date(stats.current.end+'T00:00:00');
      document.getElementById('stat-cur-range').textContent = `${MONTHS[cs.getMonth()]} ${cs.getDate()} — ${MONTHS[ce.getMonth()]} ${ce.getDate()}`;
    }

    // ===== Render 3D with obelisk.js (as original project does) =====
    function renderIsometricObelisk(days){
      // Build weeks like GitHub: padded to full weeks, week index by column.
      const first = new Date(days[0].date+'T00:00:00');
      const pad = first.getDay(); // Sunday=0
      const padded = Array.from({length:pad}, ()=>({date:null, count:0, pad:true})).concat(days);
      const totalSlots = Math.ceil(padded.length/7)*7;
      while(padded.length < totalSlots) padded.push({date:null,count:0,pad:true});
      const weeks = totalSlots/7;

      // Determine maxCount for scaling
      let maxCount = 0;
      for(const d of days) maxCount = Math.max(maxCount, d.count);

      // Map count -> GitHub greens (use our CSS vars) but obelisk wants int color.
      const hexToInt = (hex) => Number.parseInt(hex.replace('#',''), 16);
      const fillColorFor = (count) => hexToInt(colorForCount(count));

      // Setup canvas
      const canvas = document.getElementById('iso-canvas');
      const stage = document.getElementById('iso-stage');
      const tooltip = document.getElementById('tooltip');

      const ctx = canvas.getContext('2d');
      ctx.clearRect(0,0,canvas.width,canvas.height);

      const SIZE = 16;
      const MAX_HEIGHT = 100;
      const point = new obelisk.Point(160, 100);
      const pixelView = new obelisk.PixelView(canvas, point);

      // Precompute cube heights so hover can match the same scaling
      const heights = new Array(totalSlots).fill(0);

      // Render cubes
      for(let w=0; w<weeks; w++){
        for(let d=0; d<7; d++){
          const idx = w*7 + d;
          const item = padded[idx];
          if(!item || item.pad) continue;

          const count = item.count;
          let cubeHeight = 3;
          if(maxCount > 0) cubeHeight += Number.parseInt((MAX_HEIGHT / maxCount) * count, 10);
          heights[idx] = cubeHeight;

          const dimension = new obelisk.CubeDimension(SIZE, SIZE, cubeHeight);
          const colorInt = fillColorFor(count);
          const color = new obelisk.CubeColor().getByHorizontalColor(colorInt);
          const cube = new obelisk.Cube(dimension, color, false);
          const p3d = new obelisk.Point3D(SIZE * w, SIZE * d, 0);
          pixelView.renderObject(cube, p3d);
        }
      }

      // ===== Hover hit-test (near-original feel) =====
      // We can't use GitHub DOM tooltips here, so we implement our own.
      // Strategy: estimate (week, day) by inverting the isometric projection.
      // obelisk pixel projection (approx):
      //   sx = originX + (x - y)
      //   sy = originY + (x + y)/2 - z
      // where x,y are in "SIZE" units.
      // We'll solve for x,y from mouse position, then clamp to grid.

      const isoToGrid = (mx, my) => {
        // mx,my are relative to canvas top-left
        const sx = mx - point.x;
        const sy = my - point.y;

        // Ignore z for picking; we want the column/row under cursor.
        // From:
        //   sx = x - y
        //   sy ≈ (x + y)/2
        // Solve:
        //   x = sy + sx/2
        //   y = sy - sx/2
        const x = sy + sx/2;
        const y = sy - sx/2;

        const w = Math.floor(x / SIZE + 0.00001);
        const d = Math.floor(y / SIZE + 0.00001);
        return { w, d };
      };

      const showTooltip = (ev, item) => {
        const rect = stage.getBoundingClientRect();
        tooltip.style.display = 'block';
        tooltip.style.opacity = '1';
        tooltip.style.left = `${ev.clientX - rect.left}px`;
        tooltip.style.top = `${ev.clientY - rect.top}px`;
        const dateText = formatDateHuman(item.date);
        tooltip.innerHTML = `<div><strong>${item.count}</strong> contributions</div><div class="k">on ${dateText}</div>`;
      };

      const hideTooltip = () => {
        tooltip.style.opacity = '0';
        tooltip.style.display = 'none';
      };

      // Remove previous handlers if re-rendered
      canvas.onmousemove = null;
      canvas.onmouseleave = null;

      canvas.addEventListener('mousemove', (ev) => {
        const cRect = canvas.getBoundingClientRect();
        const mx = (ev.clientX - cRect.left) * (canvas.width / cRect.width);
        const my = (ev.clientY - cRect.top) * (canvas.height / cRect.height);

        const { w, d } = isoToGrid(mx, my);
        if (w < 0 || d < 0 || w >= weeks || d >= 7) {
          hideTooltip();
          return;
        }

        const idx = w*7 + d;
        const item = padded[idx];
        if (!item || item.pad || !item.date) {
          hideTooltip();
          return;
        }

        // Additional check: cursor should be above the base diamond region.
        // If user points far above, projection may map incorrectly. We do a soft guard by checking local cell center distance.
        const centerX = point.x + (w*SIZE - d*SIZE) + SIZE/2;
        const centerY = point.y + (w*SIZE + d*SIZE)/2;
        const dist = Math.hypot(mx - centerX, my - centerY);
        if (dist > SIZE*1.2) {
          hideTooltip();
          return;
        }

        showTooltip(ev, item);
      }, { passive: true });

      canvas.addEventListener('mouseleave', hideTooltip, { passive: true });
    }

    // ===== Render 2D heatmap (keep) =====
    function renderHeatmap(days){
      const cells = document.getElementById('cells');
      cells.innerHTML = '';

      const first = new Date(days[0].date+'T00:00:00');
      const pad = first.getDay();
      const padded = Array.from({length:pad}, ()=>({date:null,count:0,pad:true})).concat(days);
      const totalSlots = Math.ceil(padded.length/7)*7;
      while(padded.length < totalSlots) padded.push({date:null,count:0,pad:true});
      const weeks = totalSlots/7;

      const monthsEl = document.getElementById('months');
      monthsEl.innerHTML = '';

      const monthAtWeek = new Map();
      for(let w=0; w<weeks; w++){
        for(let d=0; d<7; d++){
          const item = padded[w*7+d];
          if(item && !item.pad && item.date){
            const dt = new Date(item.date+'T00:00:00');
            const m = dt.getMonth();
            const key = `${dt.getFullYear()}-${m}`;
            if(!monthAtWeek.has(key)) monthAtWeek.set(key, w);
            break;
          }
        }
      }

      monthsEl.style.gridTemplateColumns = `repeat(${weeks}, 12px)`;
      for(const [key, w] of monthAtWeek.entries()){
        const [, m] = key.split('-').map(Number);
        const span = document.createElement('span');
        span.textContent = MONTHS[m];
        span.style.gridColumn = String(w+1);
        monthsEl.appendChild(span);
      }

      for(let w=0; w<weeks; w++){
        for(let d=0; d<7; d++){
          const item = padded[w*7+d];
          const cell = document.createElement('div');
          cell.className = 'cell';
          if(item && !item.pad && item.date){
            cell.style.background = colorForCount(item.count);
            cell.title = `${item.count} contributions on ${formatDateHuman(item.date)}`;
          } else {
            cell.style.background = 'transparent';
            cell.style.boxShadow = 'none';
          }
          cells.appendChild(cell);
        }
      }
    }

    // ===== View controls =====
    function setView(mode){
      const isoShell = document.getElementById('iso-shell');
      const btn3d = document.getElementById('btn-3d');
      const btn2d = document.getElementById('btn-2d');
      if(mode==='3d'){
        isoShell.style.display = '';
        btn3d.setAttribute('aria-pressed','true');
        btn2d.setAttribute('aria-pressed','false');
      } else {
        isoShell.style.display = 'none';
        btn3d.setAttribute('aria-pressed','false');
        btn2d.setAttribute('aria-pressed','true');
      }
    }

    // ===== GitHub GraphQL (token-ready) =====
    // URL: https://api.github.com/graphql
    // Docs: https://docs.github.com/en/graphql
    async function fetchRealContributions(username, token){
      const query = `
        query($login: String!) {
          user(login: $login) {
            contributionsCollection {
              contributionCalendar {
                weeks {
                  contributionDays {
                    contributionCount
                    date
                  }
                }
              }
            }
          }
        }
      `;

      const res = await fetch('https://api.github.com/graphql', {
        method: 'POST',
        headers: {
          'Authorization': `bearer ${token}`,
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({ query, variables: { login: username } })
      });
      if(!res.ok) throw new Error(`GitHub GraphQL error: ${res.status}`);
      const json = await res.json();
      const weeks = json?.data?.user?.contributionsCollection?.contributionCalendar?.weeks || [];
      const days = weeks.flatMap(w => (w.contributionDays||[]).map(d => ({date: d.date, count: d.contributionCount})));
      return days.slice(-365);
    }

    // ===== Init =====
    (function init(){
      const days = generateContributionData();
      renderIsometricObelisk(days);
      renderHeatmap(days);
      applyStats(calcStats(days));

      document.getElementById('btn-3d').addEventListener('click', ()=>setView('3d'));
      document.getElementById('btn-2d').addEventListener('click', ()=>setView('2d'));

      document.getElementById('hide-normal').addEventListener('change', (e)=>{
        document.getElementById('heatmap-wrap').style.display = e.target.checked ? 'none' : '';
      });

      document.getElementById('btn-settings').addEventListener('click', ()=>{
        const btn = document.getElementById('btn-settings');
        const expanded = btn.getAttribute('aria-expanded') === 'true';
        btn.setAttribute('aria-expanded', expanded ? 'false' : 'true');
        alert('Mock: Contribution settings.\n\nToken-ready API wiring point:\nhttps://api.github.com/graphql');
      });

      // Token wiring (disabled by default)
      // const token = 'YOUR_GITHUB_TOKEN';
      // fetchRealContributions('jvisualschool', token)
      //   .then(realDays => {
      //     renderIsometricObelisk(realDays);
      //     renderHeatmap(realDays);
      //     applyStats(calcStats(realDays));
      //   })
      //   .catch(console.error);
    })();
  </script>
</body>
</html>
